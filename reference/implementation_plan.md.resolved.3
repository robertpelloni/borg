
# Phase 23: Skills & Guardrails (Factory Droid Absorption)

## Goal
Achieve feature parity with Factory Droid by implementing a text-based "Skills" system and a secure "Guardrails" engine.

## 1. Skills Engine
**Objective:** Allow users to define reusable workflows in `SKILL.md` files.

### Changes
*   **[NEW] `packages/core/src/skills/SkillRegistry.ts`**:
    *   Scans `~/.aios/skills` and `./.aios/skills`.
    *   Parses YAML frontmatter + Markdown.
    *   Exposes `list_skills` and `read_skill` tools.
*   **[MODIFY] [packages/core/src/MCPServer.ts](file:///c:/Users/hyper/workspace/aios/packages/core/src/MCPServer.ts)**:
    *   Initialize `SkillRegistry`.
    *   Inject available skills into the system prompt or tool list (Dynamic Disclosure).

## 2. Guardrails (Permission Manager)
**Objective:** Prevent dangerous actions without approval.

### Changes
*   **[NEW] `packages/core/src/security/PermissionManager.ts`**:
    *   `checkPermission(toolName, args, autonomyLevel)` -> `boolean`.
    *   Risk Rules:
        *   **High:** `rm -rf`, `git push`, sensitive file reads.
        *   **Medium:** `npm install`, file edits.
        *   **Low:** [ls](file:///c:/Users/hyper/workspace/aios/packages/core/src/Router.ts#43-57), `cat`, `git status`.
*   **[MODIFY] [packages/core/src/MCPServer.ts](file:///c:/Users/hyper/workspace/aios/packages/core/src/MCPServer.ts)**:
    *   Wrap `CallTool` handler.
    *   Before execution, call `PermissionManager.checkPermission()`.
    *   If denied, return `UserApprovalRequired` error or prompt user (via TUI request).

## 3. Autonomy Levels
**Objective:** Allow users to set "Cruise Control".

*   **[MODIFY] [packages/cli/src/index.ts](file:///c:/Users/hyper/workspace/aios/packages/cli/src/index.ts)**:
    *   Add `--auto <level>` flag (`low`, `medium`, `high`).
    *   Pass this config to Core start.
